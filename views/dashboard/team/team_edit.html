{{define "team_edit"}}
<div class="flex flex-col rounded-lg border bg-card text-card-foreground shadow-sm p-6 divide-y mb-4">
  <section class="space-y-4">
    <h1 class="text-3xl font-bold">Edit Team</h1>
    <div id="message"></div>
    <form class="space-y-6" hx-post="/dashboard/team/{{.Team.Id}}" hx-target="#message">
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
          for="name">
          Team Name
        </label>
        <input
          class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          name="name" placeholder="Enter team name" value="{{.Team.Name}}" />
      </div>
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
          for="description">
          Description
        </label>
        <textarea
          class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[100px]"
          name="description" placeholder="Enter team description">{{.Team.Description}}</textarea>
      </div>
      <section class="flex justify-end">
        <button
          class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 rounded-md"
          type="submit">
          Update
        </button>
      </section>
    </form>
  </section>
</div>
<div class="flex flex-col rounded-lg border bg-card text-card-foreground shadow-sm p-6 divide-y mb-4">
  <section class="space-y-4">
    <h2 class="text-lg font-medium">
      Team Members
    </h2>
    <div class="grid gap-4 py-4" id="members">
      {{template "team_members" .}}
    </div>

    <form class="flex items-center gap-2" hx-put="/dashboard/team/{{.Team.Id}}/members" hx-target="#members">
      <input
        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 flex-1"
        placeholder="Enter new member email" type="text" name="email" />
      <select
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-32 p-2.5 "
        name="permission">
        {{range .Permissions }}
        <option value="{{.}}">{{.}}</option>
        {{ end }}
      </select>

      <button
        class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 rounded-md"
        type="submit">
        Add User
      </button>
    </form>
  </section>
</div>

<div class="flex flex-col rounded-lg border bg-card text-card-foreground shadow-sm p-6 divide-y">
  <section>
    <h1 class="text-3xl font-bold py-4">Team links</h1>
    <table class="w-full caption-bottom text-sm">
      {{template "link_table_header"}}
      <tbody class="[&amp;_tr:last-child]:border-0" id="search-results">
        {{template "link_table" .Team}}
      </tbody>
    </table>
  </section>
</div>
{{end}}

{{define "team_members"}}
{{range .Memebers}}
<div class="flex items-center justify-between" id="member-{{.User.Id}}">
  <div class="flex items-center gap-4">
    <span class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full">
      <span class="flex h-full w-full items-center justify-center rounded-full bg-slate-500">OM</span>
    </span>
    <div>
      <p class="text-sm font-medium leading-none">{{.User.Username}}</p>
      <p class="text-sm text-gray-500 dark:text-gray-400">{{.User.Email}}</p>
    </div>
  </div>
  <div class="flex items-center gap-2">
    {{$permission := .Permission}}
    <select
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-32 p-2.5 "
      hx-post="/dashboard/team/{{$.Team.Id}}/members"
      hx-vals='js:{"email":"{{.User.Email}}"}'
      hx-target="#members"
      name="permission"
      value="{{$permission}}"
      >
      {{range $.Permissions }}
      <option value="{{.}}" {{ if eq . $permission }} selected="selected" {{ end }}>{{.}}</option>
      {{ end }}
    </select>
    </form>
    <button
      class="p-2.5 inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10 border border-gray-200 rounded-md"
      hx-delete="/dashboard/team/{{$.Team.Id}}/members"
      hx-confirm="Are you sure you want to delete this item?"
      hx-target="#member-{{.User.Id}}"
      hx-vals='js:{"email":"{{.User.Email}}"}'
      hx-swap="outerHTML:remove" 
      >
      {{template "delete_icon"}}
      <span class="sr-only">Delete</span>
    </button>
  </div>
</div>
{{end}}
{{end}}